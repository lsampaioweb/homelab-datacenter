Running 11-proxmox-ubuntu-server-standard/packer/ with commands: [build home]
credentials.null.password: output will be in this color.

==> credentials.null.password: Running local shell script: /tmp/packer-shell3116912747
Build 'credentials.null.password' finished after 141 milliseconds 745 microseconds.

==> Wait completed after 141 milliseconds 849 microseconds

==> Builds finished. The artifacts of successful builds are:
--> credentials.null.password: Did not export anything. This is the null builder
build.proxmox-clone.template: output will be in this color.

==> build.proxmox-clone.template: Creating ephemeral key pair for SSH communicator...
==> build.proxmox-clone.template: Created ephemeral SSH key pair for communicator
==> build.proxmox-clone.template: Creating VM
==> build.proxmox-clone.template: Starting VM
==> build.proxmox-clone.template: Waiting for SSH to become available...
==> build.proxmox-clone.template: Connected to SSH!
==> build.proxmox-clone.template: Provisioning with Ansible...
    build.proxmox-clone.template: Setting up proxy adapter for Ansible....
==> build.proxmox-clone.template: Executing Ansible: ansible-playbook -e packer_build_name="template" -e packer_builder_type=proxmox-clone --ssh-extra-args '-o IdentitiesOnly=yes' --extra-vars hostname='ubuntu-24-04-server-standard' -e ansible_ssh_private_key_file=/tmp/ansible-key3987639917 -i /tmp/packer-provisioner-ansible1929415732 /home/lsampaio/git/datacenter/02-packer/11-proxmox-ubuntu-server-standard/ansible/template.yml
    build.proxmox-clone.template:
    build.proxmox-clone.template: PLAY [Preparing the template with the standard settings] ***********************
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [Gathering Facts] *********************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:44:58 -0300 (0:00:00.057)       0:00:00.057 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting the name of the server] *******************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:00 -0300 (0:00:02.588)       0:00:02.646 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting the localhost name of the server] *********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:02 -0300 (0:00:01.466)       0:00:04.113 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Waiting for cloud-init / user-data to finish] *****************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:03 -0300 (0:00:00.754)       0:00:04.867 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Ensure no other package operations are running] ***************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:16 -0300 (0:00:13.022)       0:00:17.890 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing apt lock files] **************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:16 -0300 (0:00:00.495)       0:00:18.386 **********
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock-frontend)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Upgrading the packages] ***************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:17 -0300 (0:00:01.071)       0:00:19.458 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Apt packages] *************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:45:21 -0300 (0:00:03.630)       0:00:23.088 **********
    build.proxmox-clone.template: changed: [default] => (item={'name': 'sshpass'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'libsecret-tools'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'gnome-keyring'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'ethtool'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'curl'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'traceroute'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'whois'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'net-tools'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'tree'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'uuid'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'ufw'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'fail2ban'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'restic'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'acl'})
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Manually upgrading any left over packages] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:55 -0300 (0:03:34.658)       0:03:57.747 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing dependencies that are no longer required and unnecessary packages from the cache] ***
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:56 -0300 (0:00:00.069)       0:03:57.817 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting up IPV4 as the default rule] **************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:56 -0300 (0:00:00.063)       0:03:57.880 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Ensure the ufw.log file exists] *******************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:56 -0300 (0:00:00.625)       0:03:58.506 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Managing UFW rules] *******************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:57 -0300 (0:00:00.473)       0:03:58.979 **********
    build.proxmox-clone.template: changed: [default] => (item={'rule': 'allow', 'name': 'OpenSSH', 'comment': 'Allow OpenSSH for All'})
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting DENY as the default policy and enabling the UFW] ******
    build.proxmox-clone.template: Thursday 01 May 2025  16:48:59 -0300 (0:00:02.197)       0:04:01.177 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Copying the jail config file to the Fail2ban folder] **********
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:01 -0300 (0:00:02.393)       0:04:03.570 **********
    build.proxmox-clone.template: changed: [default] => (item={'src': 'fail2ban-ssh.conf', 'dest': '/etc/fail2ban/jail.d/ssh.conf'})
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Waiting for cloud-init / user-data to finish] *****************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:02 -0300 (0:00:01.201)       0:04:04.771 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Ensure no other package operations are running] ***************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:03 -0300 (0:00:00.963)       0:04:05.735 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing apt lock files] **************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:04 -0300 (0:00:00.490)       0:04:06.225 **********
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock-frontend)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Upgrading the packages] ***************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:05 -0300 (0:00:00.968)       0:04:07.193 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Apt packages] *************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:05 -0300 (0:00:00.064)       0:04:07.258 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Manually upgrading any left over packages] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:05 -0300 (0:00:00.060)       0:04:07.318 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing dependencies that are no longer required and unnecessary packages from the cache] ***
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:05 -0300 (0:00:00.067)       0:04:07.386 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing the machine-id file] *********************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:07 -0300 (0:00:01.500)       0:04:08.886 **********
    build.proxmox-clone.template: changed: [default] => (item=/etc/machine-id)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dbus/machine-id)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Creating the machine-id file] *********************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:08 -0300 (0:00:00.912)       0:04:09.799 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Searching for log and temp files that can be removed] *********
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:08 -0300 (0:00:00.477)       0:04:10.276 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing unnecessary files] ***********************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:09 -0300 (0:00:00.626)       0:04:10.903 **********
    build.proxmox-clone.template: changed: [default] => (item=0 - /var/log/dmesg.1.gz)
    build.proxmox-clone.template: changed: [default] => (item=1 - /var/log/apt/eipp.log.xz)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Cleaning cloud-init] ******************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:10 -0300 (0:00:00.958)       0:04:11.861 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing the history of terminal commands] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:11 -0300 (0:00:01.557)       0:04:13.419 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: RUNNING HANDLER [common : Restarting and Enabling fail2ban] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:12 -0300 (0:00:00.502)       0:04:13.921 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: PLAY RECAP *********************************************************************
    build.proxmox-clone.template: default                    : ok=24   changed=14   unreachable=0    failed=0    skipped=5    rescued=0    ignored=0
    build.proxmox-clone.template:
    build.proxmox-clone.template: Playbook run took 0 days, 0 hours, 4 minutes, 15 seconds
    build.proxmox-clone.template: Thursday 01 May 2025  16:49:13 -0300 (0:00:01.717)       0:04:15.639 **********
    build.proxmox-clone.template: ===============================================================================
    build.proxmox-clone.template: template -------------------------------------------------------------- 251.28s
    build.proxmox-clone.template: gather_facts ------------------------------------------------------------ 2.59s
    build.proxmox-clone.template: common ------------------------------------------------------------------ 1.72s
    build.proxmox-clone.template: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    build.proxmox-clone.template: total ----------------------------------------------------------------- 255.58s
==> build.proxmox-clone.template: Trying to remove ephemeral keys from authorized_keys files
==> build.proxmox-clone.template: Stopping VM
==> build.proxmox-clone.template: Converting VM to template
==> build.proxmox-clone.template: Adding a cloud-init cdrom in storage pool Ceph_Gold
Build 'build.proxmox-clone.template' finished after 5 minutes 22 seconds.

==> Wait completed after 5 minutes 22 seconds

==> Builds finished. The artifacts of successful builds are:
--> build.proxmox-clone.template: A template was created: 901
post-config.null.extra-config: output will be in this color.

==> post-config.null.extra-config: Provisioning with Ansible...
    post-config.null.extra-config: Setting up proxy adapter for Ansible....
==> post-config.null.extra-config: Executing Ansible: ansible-playbook -e packer_build_name="extra-config" -e packer_builder_type=null --extra-vars node='edge-pve-01' vm_name='ubuntu-24-04-server-standard' cpu_type='x86-64-v2-AES' hotplug='disk,network,cpu' -e ansible_ssh_private_key_file=/tmp/ansible-key2224643297 -i /home/lsampaio/git/datacenter/02-packer/11-proxmox-ubuntu-server-standard/packer/../ansible/inventory/hosts /home/lsampaio/git/datacenter/02-packer/11-proxmox-ubuntu-server-standard/ansible/kvm_setup.yml
    post-config.null.extra-config:
    post-config.null.extra-config: PLAY [Setting some extra configurations directly on the Proxmox node] **********
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [Gathering Facts] *********************************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:33 -0300 (0:00:00.017)       0:00:00.017 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Getting VM ID by name] ***************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:36 -0300 (0:00:02.520)       0:00:02.538 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Set vm_id fact] **********************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:37 -0300 (0:00:01.618)       0:00:04.157 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting CPU Type] ********************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:38 -0300 (0:00:00.127)       0:00:04.285 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting DHCP] ************************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:39 -0300 (0:00:01.470)       0:00:05.756 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting Hardware HotPlug] ************************************
    post-config.null.extra-config: Thursday 01 May 2025  16:49:41 -0300 (0:00:01.470)       0:00:07.227 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: PLAY RECAP *********************************************************************
    post-config.null.extra-config: edge-pve-01                : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
    post-config.null.extra-config:
    post-config.null.extra-config: Playbook run took 0 days, 0 hours, 0 minutes, 8 seconds
    post-config.null.extra-config: Thursday 01 May 2025  16:49:42 -0300 (0:00:01.495)       0:00:08.722 **********
    post-config.null.extra-config: ===============================================================================
    post-config.null.extra-config: kvm_setup --------------------------------------------------------------- 6.18s
    post-config.null.extra-config: gather_facts ------------------------------------------------------------ 2.52s
    post-config.null.extra-config: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    post-config.null.extra-config: total ------------------------------------------------------------------- 8.70s
Build 'post-config.null.extra-config' finished after 9 seconds 951 milliseconds.

==> Wait completed after 9 seconds 951 milliseconds

==> Builds finished. The artifacts of successful builds are:
--> post-config.null.extra-config: Did not export anything. This is the null builder
Finished 11-proxmox-ubuntu-server-standard/packer/
