Running 20-proxmox-ubuntu-desktop-raw/packer/ with commands: [build home]
credentials.null.password: output will be in this color.

==> credentials.null.password: Running local shell script: /tmp/packer-shell2734649352
Build 'credentials.null.password' finished after 114 milliseconds 596 microseconds.

==> Wait completed after 114 milliseconds 683 microseconds

==> Builds finished. The artifacts of successful builds are:
--> credentials.null.password: Did not export anything. This is the null builder
build.proxmox-clone.template: output will be in this color.

==> build.proxmox-clone.template: Creating ephemeral key pair for SSH communicator...
==> build.proxmox-clone.template: Created ephemeral SSH key pair for communicator
==> build.proxmox-clone.template: Creating VM
==> build.proxmox-clone.template: Starting VM
==> build.proxmox-clone.template: Waiting for SSH to become available...
==> build.proxmox-clone.template: Connected to SSH!
==> build.proxmox-clone.template: Provisioning with Ansible...
    build.proxmox-clone.template: Setting up proxy adapter for Ansible....
==> build.proxmox-clone.template: Executing Ansible: ansible-playbook -e packer_build_name="template" -e packer_builder_type=proxmox-clone --ssh-extra-args '-o IdentitiesOnly=yes' --extra-vars hostname='ubuntu-24-04-desktop-raw' -e ansible_ssh_private_key_file=/tmp/ansible-key3577794720 -i /tmp/packer-provisioner-ansible2281754935 /home/lsampaio/git/datacenter/02-packer/20-proxmox-ubuntu-desktop-raw/ansible/template.yml
    build.proxmox-clone.template:
    build.proxmox-clone.template: PLAY [Preparing the template with the minimum settings] ************************
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [Gathering Facts] *********************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:09 -0300 (0:00:00.040)       0:00:00.040 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting the name of the server] *******************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:11 -0300 (0:00:02.533)       0:00:02.573 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Setting the localhost name of the server] *********************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:13 -0300 (0:00:01.526)       0:00:04.100 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Waiting for cloud-init / user-data to finish] *****************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:14 -0300 (0:00:00.712)       0:00:04.812 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Ensure no other package operations are running] ***************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:19 -0300 (0:00:05.178)       0:00:09.990 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing apt lock files] **************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:19 -0300 (0:00:00.510)       0:00:10.501 **********
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock-frontend)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Upgrading the packages] ***************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:20 -0300 (0:00:01.110)       0:00:11.612 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Apt packages] *************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  16:53:24 -0300 (0:00:03.599)       0:00:15.212 **********
    build.proxmox-clone.template: changed: [default] => (item={'name': 'gdm3'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'ubuntu-desktop-minimal'})
    build.proxmox-clone.template: changed: [default] => (item={'name': 'libnss3-tools'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'gnome-keyring'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'network-manager'})
    build.proxmox-clone.template: ok: [default] => (item={'name': 'network-manager-gnome'})
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Manually upgrading any left over packages] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:08 -0300 (0:18:43.909)       0:18:59.121 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing dependencies that are no longer required and unnecessary packages from the cache] ***
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:08 -0300 (0:00:00.069)       0:18:59.190 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Adding the NetworkManager in the netplan config file] *********
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:08 -0300 (0:00:00.066)       0:18:59.257 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Disabling systemd-networkd service] ***************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:09 -0300 (0:00:00.626)       0:18:59.883 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Waiting for cloud-init / user-data to finish] *****************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:10 -0300 (0:00:01.760)       0:19:01.644 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Ensure no other package operations are running] ***************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:11 -0300 (0:00:00.982)       0:19:02.627 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing apt lock files] **************************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:12 -0300 (0:00:00.506)       0:19:03.134 **********
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dpkg/lock-frontend)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Upgrading the packages] ***************************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:13 -0300 (0:00:00.931)       0:19:04.065 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Apt packages] *************************************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:13 -0300 (0:00:00.072)       0:19:04.138 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Manually upgrading any left over packages] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:13 -0300 (0:00:00.069)       0:19:04.207 **********
    build.proxmox-clone.template: skipping: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing dependencies that are no longer required and unnecessary packages from the cache] ***
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:13 -0300 (0:00:00.075)       0:19:04.282 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing the machine-id file] *********************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:15 -0300 (0:00:01.580)       0:19:05.862 **********
    build.proxmox-clone.template: changed: [default] => (item=/etc/machine-id)
    build.proxmox-clone.template: changed: [default] => (item=/var/lib/dbus/machine-id)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Creating the machine-id file] *********************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:16 -0300 (0:00:00.960)       0:19:06.823 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Searching for log and temp files that can be removed] *********
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:16 -0300 (0:00:00.475)       0:19:07.299 **********
    build.proxmox-clone.template: ok: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing unnecessary files] ***********************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:17 -0300 (0:00:00.642)       0:19:07.941 **********
    build.proxmox-clone.template: changed: [default] => (item=0 - /var/log/dmesg.1.gz)
    build.proxmox-clone.template: changed: [default] => (item=1 - /var/log/apt/eipp.log.xz)
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Cleaning cloud-init] ******************************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:18 -0300 (0:00:00.962)       0:19:08.904 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: TASK [template : Removing the history of terminal commands] ********************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:19 -0300 (0:00:01.695)       0:19:10.600 **********
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: RUNNING HANDLER [common : Netplan Apply] ***************************************
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:20 -0300 (0:00:00.523)       0:19:11.123 **********
    build.proxmox-clone.template: ASYNC OK on default: jid=j50830729037.25220
    build.proxmox-clone.template: changed: [default]
    build.proxmox-clone.template:
    build.proxmox-clone.template: PLAY RECAP *********************************************************************
    build.proxmox-clone.template: default                    : ok=21   changed=11   unreachable=0    failed=0    skipped=5    rescued=0    ignored=0
    build.proxmox-clone.template:
    build.proxmox-clone.template: Playbook run took 0 days, 0 hours, 19 minutes, 16 seconds
    build.proxmox-clone.template: Thursday 01 May 2025  17:12:26 -0300 (0:00:05.608)       0:19:16.732 **********
    build.proxmox-clone.template: ===============================================================================
    build.proxmox-clone.template: template ------------------------------------------------------------- 1148.55s
    build.proxmox-clone.template: common ------------------------------------------------------------------ 5.61s
    build.proxmox-clone.template: gather_facts ------------------------------------------------------------ 2.53s
    build.proxmox-clone.template: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    build.proxmox-clone.template: total ---------------------------------------------------------------- 1156.69s
==> build.proxmox-clone.template: Trying to remove ephemeral keys from authorized_keys files
==> build.proxmox-clone.template: Stopping VM
==> build.proxmox-clone.template: Converting VM to template
==> build.proxmox-clone.template: Adding a cloud-init cdrom in storage pool Ceph_Gold
Build 'build.proxmox-clone.template' finished after 20 minutes 33 seconds.

==> Wait completed after 20 minutes 33 seconds

==> Builds finished. The artifacts of successful builds are:
--> build.proxmox-clone.template: A template was created: 910
post-config.null.extra-config: output will be in this color.

==> post-config.null.extra-config: Provisioning with Ansible...
    post-config.null.extra-config: Setting up proxy adapter for Ansible....
==> post-config.null.extra-config: Executing Ansible: ansible-playbook -e packer_build_name="extra-config" -e packer_builder_type=null --extra-vars node='edge-pve-01' vm_name='ubuntu-24-04-desktop-raw' cpu_type='x86-64-v2-AES' hotplug='disk,network,cpu' -e ansible_ssh_private_key_file=/tmp/ansible-key674031318 -i /home/lsampaio/git/datacenter/02-packer/20-proxmox-ubuntu-desktop-raw/packer/../ansible/inventory/hosts /home/lsampaio/git/datacenter/02-packer/20-proxmox-ubuntu-desktop-raw/ansible/kvm_setup.yml
    post-config.null.extra-config:
    post-config.null.extra-config: PLAY [Setting some extra configurations directly on the Proxmox node] **********
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [Gathering Facts] *********************************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:51 -0300 (0:00:00.017)       0:00:00.017 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Getting VM ID by name] ***************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:54 -0300 (0:00:02.310)       0:00:02.328 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Set vm_id fact] **********************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:55 -0300 (0:00:01.681)       0:00:04.009 **********
    post-config.null.extra-config: ok: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting CPU Type] ********************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:56 -0300 (0:00:00.139)       0:00:04.149 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting DHCP] ************************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:57 -0300 (0:00:01.897)       0:00:06.047 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: TASK [kvm_setup : Setting Hardware HotPlug] ************************************
    post-config.null.extra-config: Thursday 01 May 2025  17:12:59 -0300 (0:00:01.484)       0:00:07.531 **********
    post-config.null.extra-config: changed: [edge-pve-01]
    post-config.null.extra-config:
    post-config.null.extra-config: PLAY RECAP *********************************************************************
    post-config.null.extra-config: edge-pve-01                : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
    post-config.null.extra-config:
    post-config.null.extra-config: Playbook run took 0 days, 0 hours, 0 minutes, 9 seconds
    post-config.null.extra-config: Thursday 01 May 2025  17:13:00 -0300 (0:00:01.509)       0:00:09.040 **********
    post-config.null.extra-config: ===============================================================================
    post-config.null.extra-config: kvm_setup --------------------------------------------------------------- 6.71s
    post-config.null.extra-config: gather_facts ------------------------------------------------------------ 2.31s
    post-config.null.extra-config: ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    post-config.null.extra-config: total ------------------------------------------------------------------- 9.02s
Build 'post-config.null.extra-config' finished after 10 seconds 275 milliseconds.

==> Wait completed after 10 seconds 275 milliseconds

==> Builds finished. The artifacts of successful builds are:
--> post-config.null.extra-config: Did not export anything. This is the null builder
Finished 20-proxmox-ubuntu-desktop-raw/packer/
